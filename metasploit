FROM ubuntu:latest
RUN apt-get update && apt-get -y upgrade && apt-get -y install build-essential libreadline-dev libssl-dev libpq5 libpq-dev \
libreadline5 libsqlite3-dev libpcap-dev git-core autoconf postgresql pgadmin3 \
zlib1g-dev libxml2-dev libxslt1-dev libyaml-dev ruby1.9.3 ruby-dev curl
RUN gem install wirble sqlite3 bundler

RUN curl http://nmap.org/dist/nmap-6.47.tar.bz2 | tar xj -C /tmp/ && \
	cd /tmp/nmap/ && ./configure && make && make install

RUN git clone https://github.com/rapid7/metasploit-framework.git /opt/metasploit-framework && \
	cd /opt/metasploit-framework && bundle install

ADD database.yml /opt/metasploit-framework/config/
USER postgres
RUN /etc/init.d/postgresql start && \
	psql --command "CREATE USER msf WITH PASSWORD 'msf';" && \
	createdb -O  msf msf

USER root
RUN ln -s /opt/metasploit-framework/msf* /usr/bin/
WORKDIR /opt/metasploit-framework/
ENV HOME /opt/metasploit-framework/
CMD sudo -bu postgres /usr/lib/postgresql/9.4/bin/postgres -D /var/lib/postgresql/9.4/main -c config_file=/etc/postgresql/9.4/main/postgresql.conf ; sleep 2 ; /bin/bash
