FROM base/archlinux:latest
MAINTAINER UserTaken <elysian@live.com>
ENV SHELL /bin/bash
ENV HOME /root
WORKDIR /root
RUN curl -O http://blackarch.org/keyring/blackarch-keyring.pkg.tar.xz && \
	curl -O http://blackarch.org/keyring/blackarch-keyring.pkg.tar.xz.sig && \
	gpg --keyserver hkp://pgp.mit.edu --recv 4345771566D76038C7FEB43863EC0ADBEA87E4E3 && \
	gpg --keyserver-o no-auto-key-retrieve --with-f blackarch-keyring.pkg.tar.xz.sig && \
	rm blackarch-keyring.pkg.tar.xz.sig && \
	pacman-key --init && \
	pacman-key -r CC1D2606 && \
	pacman-key --lsign-key CC1D2606 && \
	pacman --noc -U blackarch-keyring.pkg.tar.xz && \
	rm blackarch-keyring.pkg.tar.xz

RUN echo "[multilib]" >> /etc/pacman.conf && \
	echo "Include = /etc/pacman.d/mirrorlist"  >> /etc/pacman.conf && \
	echo "[blackarch]" >> /etc/pacman.conf && \
	echo "Server = http://blackarch.org/blackarch/\$repo/os/\$arch" >> /etc/pacman.conf && \
	echo "[archassault]" >> /etc/pacman.conf && \
	echo "Server = http://repo.archassault.org/archassault/\$repo/os/\$arch" >> /etc/pacman.conf

RUN pacman -Syu base-devel archassault-keyring firefox firefox-adblock-plus flashplugin screen yaourt nload  \
	net-tools openssh aria2 leafpad htop man tigervnc lxde ttf-dejavu --noc --needed --ignore filesystem && \
	rm -rf /var/cache/pacman/pkg/*

RUN cp /etc/skel/.bashrc /root/ && \
	echo "alias blackarch='pacman -Sgg | sort -u | grep --color "archassault\|blackarch"'" >> /root/.bashrc && \
	echo "alias pacman='pacman --noc'" >> /root/.bashrc && \
	echo "alias yaourt='yaourt --noconfirm'" >> /root/.bashrc

RUN mkdir /root/.vnc && \
	echo "startlxde" > /root/.vnc/xstartup && \
	echo "killall Xvnc 2> /dev/null" > /usr/bin/startx && \
	echo "rm -rf /tmp/.* 2> /dev/null" >> /usr/bin/startx && \	
	echo "vncserver :0 -depth 16 -name Blackarch -SecurityTypes None" >> /usr/bin/startx && \
	echo "sed -n 8,11p ~/.vnc/*.log" >> /usr/bin/startx

ADD README.md /root/
ADD armitage-setup /root/
RUN chmod +x /root/armitage-setup /root/.vnc/xstartup /usr/bin/startx
EXPOSE 5900
CMD ["/bin/bash"]
